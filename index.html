<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rock • Paper • Scissors — Neon Arcade</title>
<style>
  :root{
    --bg1: #0b1020;
    --bg2: #131a34;
    --accent: #7cf5ff;
    --accent2:#b388ff;
    --win:#35f68b;
    --lose:#ff5e6a;
    --draw:#ffdb6e;
    --text:#e9f2ff;
    --muted:#b8c6e3;
    --panel:#101935a6;
    --panel-solid:#101935f0;
    --glass:#ffffff0f;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 10% -10%, #1b2c6b22, transparent 60%),
      radial-gradient(1000px 800px at 120% 20%, #7c2bff15, transparent 60%),
      linear-gradient(135deg,var(--bg1),var(--bg2));
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    overflow:hidden;
  }

  /* Animated ambient gradient shimmer */
  body:before, body:after{
    content:"";
    position:fixed; inset:-20%;
    background: conic-gradient(from 0deg, #7c2bff10, #00eaff10, transparent 30%);
    filter: blur(60px);
    animation: swirl 24s linear infinite;
    pointer-events:none;
  }
  body:after{ animation-duration: 38s; mix-blend-mode: screen; opacity:.6}
  @keyframes swirl{to{transform: rotate(360deg)}}

  /* Canvas for FX */
  #fx{
    position:fixed; inset:0; width:100%; height:100%;
    pointer-events:none; z-index: 0;
  }

  .wrap{
    position:relative; z-index:1;
    height:100%; width:100%;
    display:grid; place-items:center;
    padding: 20px;
  }

  .panel{
    width:min(980px, 94vw);
    background: linear-gradient(180deg, var(--panel), var(--panel-solid));
    border: 1px solid #ffffff1a;
    border-radius: 18px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(10px) saturate(120%);
    padding: 18px 18px 20px;
  }

  .topbar{
    display:flex; align-items:center; justify-content:space-between;
    gap:12px; padding: 6px 6px 8px;
  }
  .title{
    display:flex; align-items:center; gap:10px; letter-spacing:.4px;
    font-weight:800; font-size: clamp(18px, 2.1vw, 24px);
    text-shadow: 0 0 12px #00eaff40;
  }
  .title .dot{ color: var(--accent2)}
  .title .badge{
    font-size:.72em; padding:.22em .6em; border-radius: 999px;
    background: linear-gradient(90deg, #00eaff30, #7c2bff30);
    border:1px solid #ffffff1a; color:#cdeaff;
  }
  .toggles{
    display:flex; gap:8px; align-items:center;
  }
  .toggle{
    display:flex; align-items:center; gap:8px;
    background: #0f1730aa;
    border:1px solid #ffffff1a;
    border-radius: 12px; padding:8px 10px;
    cursor:pointer; user-select:none;
    transition: transform .12s ease, background .2s ease, border-color .2s ease;
  }
  .toggle:active{ transform: scale(.98) }
  .toggle .led{
    width:14px; height:14px; border-radius:50%;
    box-shadow: 0 0 10px currentColor;
  }
  .toggle.on .led{ color: var(--win); background: var(--win) }
  .toggle.off .led{ color: #6b7280; background: #6b7280 }
  .toggle .label{ color: var(--muted); font-weight:600; font-size: 12.5px}

  .scores{
    display:flex; gap:16px; align-items:center; justify-content: center;
    margin: 6px 0 10px;
  }
  .score{
    flex:1; min-width: 180px; display:flex; align-items:center; justify-content:space-between;
    background: #0d1430cc; border:1px solid #ffffff1a;
    border-radius: 14px; padding: 10px 14px;
  }
  .score h3{ margin:0; font-size: 13px; color:var(--muted); font-weight:700; letter-spacing:.4px }
  .score .val{ font-size: 26px; font-weight:900; letter-spacing: .5px }
  .score.me .val{ color: #b6faff }
  .score.bot .val{ color: #e7c6ff }
  .score .streak{ font-size:12px; color:#a7b4d8 }

  .arena{
    position:relative;
    display:grid; grid-template-columns: 1fr auto 1fr;
    align-items:center; gap: 14px;
    padding: 14px 10px 18px;
  }
  .side{
    display:grid; gap:10px;
  }

  .card{
    position:relative;
    border-radius: 16px;
    border: 1px solid #ffffff1a;
    background: radial-gradient(120px 80px at 20% 0%, #ffffff0c, transparent 60%), #0f1734e0;
    min-height: 120px;
    display:grid; place-items:center;
    perspective: 800px;
    overflow:hidden;
    box-shadow: inset 0 0 0 1px #ffffff0a;
  }
  .card .inner{
    position:relative;
    width: 100%; height: 100%;
    transform-style: preserve-3d;
    transition: transform .7s cubic-bezier(.2,.8,.2,1);
  }
  .card.reveal .inner{ transform: rotateY(180deg) }
  .card .face{
    position:absolute; inset:0; display:grid; place-items:center;
    backface-visibility:hidden; padding:12px;
  }
  .card .back{ transform: rotateY(180deg) }

  .choice-icon{
    font-size: clamp(40px, 8vw, 72px);
    filter: drop-shadow(0 4px 12px #00000070);
    transform: translateZ(30px);
  }
  .label{
    position:absolute; bottom:8px; left:10px; right:10px;
    text-align:center; font-size: 12px; color: var(--muted)
  }
  .me .choice-icon{ text-shadow: 0 0 24px #00eaff40 }
  .bot .choice-icon{ text-shadow: 0 0 24px #cba3ff40 }

  .vs{
    position:relative; width: 110px; height: 110px; flex:0 0 110px;
    display:grid; place-items:center;
  }
  .vs .ring{
    position:absolute; inset:0;
    border-radius:50%;
    background:
      radial-gradient(circle at 50% 50%, #ffffff50 0 2px, transparent 2px),
      conic-gradient(from 290deg, #00eaff, #b388ff);
    -webkit-mask:
      radial-gradient(circle at 50% 50%, transparent 40%, black 42%);
    mask:
      radial-gradient(circle at 50% 50%, transparent 40%, black 42%);
    filter: blur(.6px);
    animation: spin 4s linear infinite;
    opacity:.9;
  }
  @keyframes spin{ to{ transform: rotate(360deg) } }
  .vs .text{
    position:relative; z-index:1; font-weight:900; letter-spacing:1.2px;
    text-shadow: 0 0 16px #00eaff55; color:#dff7ff; font-size: 18px
  }

  .result{
    margin-top: 8px;
    text-align:center;
    font-weight:800; letter-spacing:.5px;
    font-size: clamp(16px, 2.2vw, 20px);
    min-height: 28px;
    text-shadow: 0 0 14px #ffffff15;
  }
  .result.win{ color:var(--win) }
  .result.lose{ color:var(--lose) }
  .result.draw{ color:var(--draw) }
  .result .small{ display:block; font-size: 12px; color: var(--muted); font-weight:600; letter-spacing:.3px; margin-top: 4px}

  .controls{
    margin-top: 14px; display:flex; gap: 12px; justify-content:center; flex-wrap: wrap;
  }
  .choice-btn{
    position:relative;
    appearance:none; border: none; cursor: pointer; user-select: none;
    padding: 16px 18px; min-width: 160px;
    border-radius: 14px; font-size: 18px; font-weight:900; letter-spacing:.6px;
    color:#081422;
    background: linear-gradient(175deg, #c9f6ff, #87daff);
    box-shadow:
      inset 0 1px 0 #ffffffaa,
      0 10px 18px #00b3ff35;
    transform: translateZ(0);
    transition: transform .12s cubic-bezier(.2,.9,.2,1), filter .2s ease, box-shadow .2s ease;
    outline:none;
  }
  .choice-btn .emoji{ font-size: 24px; margin-right: 10px; filter: drop-shadow(0 2px 4px #00000055) }
  .choice-btn:hover{ transform: translateY(-2px) scale(1.02); filter: saturate(1.1) }
  .choice-btn:active{ transform: translateY(1px) scale(.99) }
  .choice-btn[data-choice="rock"]{
    background: linear-gradient(175deg, #ffe3cf, #ffb779);
    box-shadow: inset 0 1px 0 #fff4ea, 0 10px 18px #ff8f0035;
  }
  .choice-btn[data-choice="paper"]{
    background: linear-gradient(175deg, #e9e9ff, #bfa9ff);
    box-shadow: inset 0 1px 0 #ffffff, 0 10px 18px #7b4dff35;
  }
  .choice-btn[data-choice="scissors"]{
    background: linear-gradient(175deg, #dcffe7, #98ffbf);
    box-shadow: inset 0 1px 0 #ffffff, 0 10px 18px #1aff7a35;
  }

  .mutebar{
    margin-top: 12px; display:flex; justify-content:center; gap:12px; flex-wrap:wrap;
  }
  .mutebar button.small{
    background: #0f1730dd; color: #d7e7ff; border:1px solid #ffffff1a;
    padding:8px 10px; border-radius: 10px; font-weight:700; letter-spacing:.4px; cursor:pointer;
  }
  .mutebar button.small:hover{ filter: brightness(1.1) }

  .foot{
    margin-top: 12px; text-align:center; color: var(--muted); font-size:12.5px
  }

  /* Glow states on cards */
  .card.win{ box-shadow: 0 0 0 1px #00ffb040, 0 0 30px #00ffb020, inset 0 0 0 1px #00ffb020 }
  .card.lose{ box-shadow: 0 0 0 1px #ff445540, 0 0 30px #ff445520, inset 0 0 0 1px #ff445520 }
  .card.draw{ box-shadow: 0 0 0 1px #ffd85b40, 0 0 30px #ffd85b20, inset 0 0 0 1px #ffd85b20 }

  /* Pulse when ready */
  .pulse{
    animation: pulse 1.8s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ transform: scale(1) }
    50%{ transform: scale(1.06) }
  }

  /* Responsive tweaks */
  @media (max-width: 760px){
    .arena{ grid-template-columns: 1fr; }
    .vs{ order:-1; margin: 8px auto }
    .side{ grid-template-columns: 1fr; }
    .card{ min-height: 100px }
    .choice-btn{ min-width: 120px; padding:14px 16px; font-size:16px }
    .choice-btn .emoji{ font-size:22px }
  }
</style>
</head>
<body>
<canvas id="fx"></canvas>

<div class="wrap">
  <div class="panel" role="application" aria-label="Rock Paper Scissors Neon Arcade">
    <div class="topbar">
      <div class="title">
        <span>Rock <span class="dot">•</span> Paper <span class="dot">•</span> Scissors</span>
        <span class="badge">Neon Arcade</span>
      </div>
      <div class="toggles">
        <div class="toggle on" id="soundToggle" role="switch" aria-checked="true" tabindex="0" title="Toggle sound">
          <span class="led"></span>
          <span class="label">Sound</span>
        </div>
        <div class="toggle on" id="fxToggle" role="switch" aria-checked="true" tabindex="0" title="Toggle particles">
          <span class="led"></span>
          <span class="label">Particles</span>
        </div>
      </div>
    </div>

    <div class="scores" aria-live="polite">
      <div class="score me">
        <h3>You</h3>
        <div class="val" id="meScore">0</div>
        <div class="streak" id="streak">Streak: 0</div>
      </div>
      <div class="score bot">
        <h3>Bot</h3>
        <div class="val" id="botScore">0</div>
        <div class="streak" id="best">Best: 0</div>
      </div>
    </div>

    <div class="arena">
      <div class="side me">
        <div class="card" id="meCard" aria-label="Your choice">
          <div class="inner">
            <div class="face front">
              <div class="choice-icon" id="meIcon">❔</div>
            </div>
            <div class="face back">
              <div class="choice-icon" id="meIconBack">❔</div>
            </div>
          </div>
          <div class="label">You</div>
        </div>
      </div>

      <div class="vs" aria-hidden="true">
        <div class="ring"></div>
        <div class="text">VS</div>
      </div>

      <div class="side bot">
        <div class="card" id="botCard" aria-label="Bot choice">
          <div class="inner">
            <div class="face front">
              <div class="choice-icon" id="botIconFront">🤖</div>
            </div>
            <div class="face back">
              <div class="choice-icon" id="botIcon">❔</div>
            </div>
          </div>
          <div class="label">Bot</div>
        </div>
      </div>
    </div>

    <div class="result pulse" id="resultText">Choose your move!</div>

    <div class="controls">
      <button class="choice-btn" data-choice="rock" aria-label="Rock (R)">
        <span class="emoji">✊</span> Rock (R)
      </button>
      <button class="choice-btn" data-choice="paper" aria-label="Paper (P)">
        <span class="emoji">✋</span> Paper (P)
      </button>
      <button class="choice-btn" data-choice="scissors" aria-label="Scissors (S)">
        <span class="emoji">✌️</span> Scissors (S)
      </button>
    </div>

    <div class="mutebar">
      <button class="small" id="resetBtn" title="Reset scores">Reset</button>
      <button class="small" id="hintBtn" title="Show tips">Tips</button>
    </div>

    <div class="foot">
      Hotkeys: R / P / S • Click the toggles to enable/disable sound and particles.
    </div>
  </div>
</div>

<script>
(() => {
  // =========================
  // Utility & Constants
  // =========================
  const CHOICES = ["rock", "paper", "scissors"];
  const EMOJI = { rock: "✊", paper: "✋", scissors: "✌️" };
  const COLORS = {
    win:["#19f0a8","#7effd1","#17d785","#2ef5c9","#b0ffe1"],
    lose:["#ff5e6a","#ff8e9b","#ff4455","#ff7080","#ffb9c0"],
    draw:["#ffd85b","#ffe79b","#ffcf3a","#ffe08a","#fff0be"],
    pulse:["#7cf5ff","#b388ff","#7cf5ff"]
  };

  const ui = {
    meScore: document.getElementById("meScore"),
    botScore: document.getElementById("botScore"),
    streak: document.getElementById("streak"),
    best: document.getElementById("best"),
    meCard: document.getElementById("meCard"),
    meIcon: document.getElementById("meIcon"),
    meIconBack: document.getElementById("meIconBack"),
    botCard: document.getElementById("botCard"),
    botIcon: document.getElementById("botIcon"),
    botIconFront: document.getElementById("botIconFront"),
    result: document.getElementById("resultText"),
    resetBtn: document.getElementById("resetBtn"),
    hintBtn: document.getElementById("hintBtn"),
    buttons: Array.from(document.querySelectorAll(".choice-btn")),
    soundToggle: document.getElementById("soundToggle"),
    fxToggle: document.getElementById("fxToggle"),
    fxCanvas: document.getElementById("fx")
  };

  // =========================
  // State
  // =========================
  let scores = { me: 0, bot: 0, streak: 0, best: 0 };
  let lastPlayer = null;
  let busy = false;

  let soundEnabled = true;
  let fxEnabled = true;

  // =========================
  // Canvas Particles
  // =========================
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  const ctx = ui.fxCanvas.getContext("2d");
  let W = 0, H = 0;
  let particles = [];
  let pointer = {x:0,y:0, t:0};

  function resize(){
    W = ui.fxCanvas.width = Math.floor(window.innerWidth * dpr);
    H = ui.fxCanvas.height = Math.floor(window.innerHeight * dpr);
    ui.fxCanvas.style.width = "100%";
    ui.fxCanvas.style.height = "100%";
  }
  window.addEventListener("resize", resize, {passive:true});
  resize();

  function rand(a,b){ return Math.random()*(b-a)+a }
  function pick(arr){ return arr[(Math.random()*arr.length)|0] }

  function spawnConfetti(x, y, count=120){
    if(!fxEnabled) return;
    const base = { x: x*dpr, y: y*dpr };
    for(let i=0;i<count;i++){
      particles.push({
        x: base.x, y: base.y,
        vx: rand(-4,4)*dpr, vy: rand(-9,-3)*dpr,
        g: rand(0.12,0.24)*dpr,
        life: rand(60,120), age: 0,
        size: rand(4,8)*dpr,
        rot: rand(0,Math.PI*2),
        vr: rand(-.2,.2),
        shape: (Math.random()<.5) ? "rect" : "tri",
        color: pick(COLORS.win),
        alpha: 1,
        air: rand(0.96,0.985)
      });
    }
  }
  function spawnShards(x,y,count=90){
    if(!fxEnabled) return;
    const base = { x: x*dpr, y: y*dpr };
    for(let i=0;i<count;i++){
      const angle = rand(-Math.PI, 0);
      const speed = rand(2,7)*dpr;
      particles.push({
        x: base.x, y: base.y,
        vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed - rand(1,2)*dpr,
        g: rand(0.08,0.18)*dpr,
        life: rand(40,80), age: 0,
        size: rand(2,5)*dpr,
        rot: rand(0,Math.PI*2),
        vr: rand(-.3,.3),
        shape: "rect",
        color: pick(COLORS.lose),
        alpha: 1,
        air: rand(0.94,0.98)
      });
    }
  }
  function spawnSparkles(x,y,count=70){
    if(!fxEnabled) return;
    const base = { x: x*dpr, y: y*dpr };
    for(let i=0;i<count;i++){
      const a = rand(0,Math.PI*2);
      const s = rand(.5,3)*dpr;
      particles.push({
        x: base.x, y: base.y,
        vx: Math.cos(a)*s, vy: Math.sin(a)*s,
        g: 0,
        life: rand(25,50), age: 0,
        size: rand(1.5,3.5)*dpr,
        rot: 0, vr:0, shape:"circ",
        color: pick(COLORS.draw),
        alpha: 1, air: .98
      });
    }
  }
  function spawnTrail(x,y){
    if(!fxEnabled) return;
    for(let i=0;i<3;i++){
      particles.push({
        x: x*dpr+rand(-6,6), y: y*dpr+rand(-6,6),
        vx: rand(-.4,.4)*dpr, vy: rand(-.6,.2)*dpr,
        g: 0.02*dpr, life: rand(20,36), age: 0,
        size: rand(1.2,2.6)*dpr, rot: 0, vr:0,
        shape:"circ", color: pick(COLORS.pulse), alpha: .95, air: .985
      });
    }
  }

  function stepParticles(){
    ctx.clearRect(0,0,W,H);
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.age++;
      if(p.age>p.life){ particles.splice(i,1); continue; }
      p.vx *= p.air; p.vy *= p.air;
      p.vy += p.g;
      p.x += p.vx; p.y += p.vy;
      p.rot += p.vr;
      const t = 1 - (p.age/p.life);
      const alpha = p.alpha * Math.max(0, Math.min(1, t));
      ctx.globalAlpha = alpha;
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.color;
      switch(p.shape){
        case "rect":
          ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.7);
          break;
        case "tri":
          ctx.beginPath();
          ctx.moveTo(0, -p.size);
          ctx.lineTo(p.size*0.6, p.size*0.6);
          ctx.lineTo(-p.size*0.6, p.size*0.6);
          ctx.closePath();
          ctx.fill();
          break;
        default: // circ
          ctx.beginPath();
          ctx.arc(0,0,p.size,0,Math.PI*2);
          ctx.fill();
      }
      ctx.restore();
    }
    ctx.globalAlpha = 1;
    requestAnimationFrame(stepParticles);
  }
  requestAnimationFrame(stepParticles);

  // Pointer trail
  window.addEventListener("pointermove", e => {
    pointer.x = e.clientX; pointer.y = e.clientY; pointer.t = performance.now();
    spawnTrail(e.clientX, e.clientY);
  }, {passive:true});

  // =========================
  // Sound (WebAudio)
  // =========================
  let audioCtx = null;

  function ensureAudio(){
    if(!audioCtx){
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    } else if (audioCtx.state === "suspended"){
      audioCtx.resume();
    }
  }

  function tone({freq=440, type="sine", dur=0.15, vol=0.2, attack=0.005, release=0.06, pan=0}={}){
    if(!soundEnabled) return;
    ensureAudio();
    const t0 = audioCtx.currentTime;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    const p = audioCtx.createStereoPanner ? audioCtx.createStereoPanner() : null;
    osc.type = type; osc.frequency.value = freq;
    gain.gain.setValueAtTime(0, t0);
    gain.gain.linearRampToValueAtTime(vol, t0+attack);
    gain.gain.exponentialRampToValueAtTime(0.0001, t0 + attack + dur + release);
    if(p){ p.pan.value = pan; osc.connect(gain); gain.connect(p); p.connect(audioCtx.destination); }
    else { osc.connect(gain); gain.connect(audioCtx.destination); }
    osc.start(t0);
    osc.stop(t0 + attack + dur + release + 0.02);
  }

  function clickSound(){ tone({freq: 240, type:"triangle", dur:.05, vol:.25}) }
  function winSound(){
    const base = 440; // A
    const notes = [base, base*1.25, base*1.5, base*2];
    notes.forEach((f,i)=> setTimeout(()=> tone({freq:f, type:"sine", dur:.08, vol:.24}), 40 + i*70));
  }
  function loseSound(){
    const notes = [440*1.5, 440*1.25, 440];
    notes.forEach((f,i)=> setTimeout(()=> tone({freq:f, type:"sawtooth", dur:.12, vol:.18}), 20 + i*120));
  }
  function drawSound(){
    tone({freq: 660, type:"square", dur:.06, vol:.18});
    setTimeout(()=> tone({freq: 660, type:"square", dur:.06, vol:.16}), 90);
  }

  // =========================
  // Game Logic
  // =========================
  function botPick(){
    // 75% random, 25% counters your last move
    if(lastPlayer && Math.random() < 0.25){
      if(lastPlayer==="rock") return "paper";
      if(lastPlayer==="paper") return "scissors";
      return "rock";
    }
    return pick(CHOICES);
  }

  function judge(me,bot){
    if(me===bot) return "draw";
    if(
      (me==="rock" && bot==="scissors") ||
      (me==="paper" && bot==="rock") ||
      (me==="scissors" && bot==="paper")
    ) return "win";
    return "lose";
  }

  function setResult(text, mode){
    ui.result.classList.remove("win","lose","draw","pulse");
    ui.result.classList.add(mode);
    ui.result.innerHTML = text;
  }

  function centerOfVs(){
    const vs = document.querySelector(".vs");
    const r = vs.getBoundingClientRect();
    return { x: r.left + r.width/2, y: r.top + r.height/2 };
  }

  function updateScores(mode){
    if(mode==="win"){ scores.me++; scores.streak++; scores.best = Math.max(scores.best, scores.streak); }
    if(mode==="lose"){ scores.bot++; scores.streak = 0; }
    ui.meScore.textContent = scores.me;
    ui.botScore.textContent = scores.bot;
    ui.streak.textContent = "Streak: " + scores.streak;
    ui.best.textContent = "Best: " + scores.best;
  }

  function flipCardsShow(me, bot){
    // Reset classes
    [ui.meCard, ui.botCard].forEach(c=>{
      c.classList.remove("win","lose","draw"); 
      c.classList.remove("reveal"); 
    });
    ui.meIcon.textContent = EMOJI[me];
    ui.meIconBack.textContent = EMOJI[me];
    ui.botIcon.textContent = EMOJI[bot];

    // Fancy reveal of bot
    void ui.botCard.offsetWidth; // reflow
    ui.botCard.classList.add("reveal");
  }

  function decorateOutcome(mode){
    ui.meCard.classList.add(mode);
    ui.botCard.classList.add(mode);
  }

  function play(me){
    if(busy) return;
    busy = true;
    lastPlayer = me;
    ui.result.classList.remove("pulse");

    clickSound();

    // Disable buttons during round
    setButtonsEnabled(false);

    // Set placeholder and flip sequence
    ui.botIconFront.textContent = "🤖";
    ui.botCard.classList.remove("reveal");
    ui.meCard.classList.remove("reveal");

    // Small anticipation delay
    setResult("Thinking...", "draw");

    setTimeout(()=>{
      const bot = botPick();
      const outcome = judge(me, bot);

      flipCardsShow(me, bot);
      // Particles
      const c = centerOfVs();
      if(outcome==="win"){ spawnConfetti(c.x, c.y, 150); winSound(); setResult("You win! 🎉", "win"); }
      else if(outcome==="lose"){ spawnShards(c.x, c.y, 120); loseSound(); setResult("You lose! 💥", "lose"); }
      else { spawnSparkles(c.x, c.y, 90); drawSound(); setResult("Draw. 🤝", "draw"); }

      updateScores(outcome);
      decorateOutcome(outcome);

      // Re-enable after a short pause
      setTimeout(()=>{
        setButtonsEnabled(true);
        ui.result.classList.add("pulse");
        busy = false;
      }, 800);
    }, 420);
  }

  function setButtonsEnabled(on){
    ui.buttons.forEach(b=>{
      b.disabled = !on;
      b.style.opacity = on ? 1 : .75;
      b.style.cursor = on ? "pointer" : "not-allowed";
    });
  }

  // =========================
  // Events
  // =========================
  ui.buttons.forEach(btn=>{
    btn.addEventListener("click", e=>{
      ensureAudio();
      const choice = btn.getAttribute("data-choice");
      // Pop a small sparkle at button
      const r = btn.getBoundingClientRect();
      spawnSparkles(r.left + r.width/2, r.top + r.height/2, 24);
      play(choice);
    });
  });

  document.addEventListener("keydown", e=>{
    const k = (e.key||"").toLowerCase();
    if(k==="r") { play("rock"); ensureAudio() }
    if(k==="p") { play("paper"); ensureAudio() }
    if(k==="s") { play("scissors"); ensureAudio() }
  });

  ui.soundToggle.addEventListener("click", ()=>{
    soundEnabled = !soundEnabled;
    ui.soundToggle.classList.toggle("on", soundEnabled);
    ui.soundToggle.classList.toggle("off", !soundEnabled);
    ui.soundToggle.setAttribute("aria-checked", String(soundEnabled));
    if(soundEnabled) clickSound();
  });
  ui.fxToggle.addEventListener("click", ()=>{
    fxEnabled = !fxEnabled;
    ui.fxToggle.classList.toggle("on", fxEnabled);
    ui.fxToggle.classList.toggle("off", !fxEnabled);
    ui.fxToggle.setAttribute("aria-checked", String(fxEnabled));
    if(fxEnabled){
      const c = centerOfVs();
      spawnSparkles(c.x, c.y, 70);
    } else {
      particles.length = 0; // clear
      ctx.clearRect(0,0,W,H);
    }
  });

  ui.resetBtn.addEventListener("click", ()=>{
    ensureAudio();
    clickSound();
    scores = { me:0, bot:0, streak:0, best: scores.best };
    ui.meScore.textContent = "0";
    ui.botScore.textContent = "0";
    ui.streak.textContent = "Streak: 0";
    setResult("Scores reset. Good luck!", "draw");
    // gentle confetti
    const c = centerOfVs();
    spawnSparkles(c.x, c.y, 60);
  });

  ui.hintBtn.addEventListener("click", ()=>{
    ensureAudio(); clickSound();
    setResult("Tip: R beats S, P beats R, S beats P. Try mixing moves!", "draw");
  });

  // Toggle accessibility with Enter/Space
  [ui.soundToggle, ui.fxToggle].forEach(el=>{
    el.addEventListener("keydown", e=>{
      if(e.key===" " || e.key==="Enter"){ e.preventDefault(); el.click(); }
    });
  });

  // Initial state classes
  ui.soundToggle.classList.add("on");
  ui.fxToggle.classList.add("on");
  setButtonsEnabled(true);
})();
</script>
</body>
</html>
